@using Microsoft.EntityFrameworkCore;
@using IndustrialContoroler.Models.FacilityViewModels;
@using IndustrialContoroler.Models.Repositories;
@model AgentsPoint;
@inject IRepository<Temporary> agentspoint;

    @if (TempData.ContainsKey("Error"))
{
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["Error"]</div>
}


@if (TempData.ContainsKey("success"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-primary ms-3 me-3" role="alert">@TempData["success"]</div>
}

@if (TempData.ContainsKey("ExFileNull"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["ExFileNull"]</div>
}

@if (TempData.ContainsKey("InsertNull"))
{
    //if no data inserted for transportations show this error massege.
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["InsertNull"]</div>
}

@{
    //get all transportations from Temporary table to show them in table.
    var GetAllAgentsPoint = agentspoint.GetAll().Where(AP => AP.TblDesc == "agentspoint").ToList();
    //for number of buildings in table.
    int counter = 1;
}

<form method="post" class="card mb-4 ms-3 me-3" enctype="multipart/form-data" style="font-family: 'Almarai', sans-serif; font-size:18px;">
            <h3 style="font-family: 'Almarai', sans-serif; font-size:20px;  background-color: rgb(82, 134, 203); color: azure;" class=" card-header py-3 mb-10 "> بيانات الوكلاء ونقاط البيع </h3>
    <div class="card-body" style="font-family: 'Almarai', sans-serif; font-size:18px;">
        <div class="d-flex justify-content-between mt-1">
            <div class="float-start">
            </div>
            <div class="float-end">
                <button type="button"
                        class="btn btn-primary btn-icon rounded-pill dropdown-toggle hide-arrow"
                        data-bs-toggle="dropdown"
                        aria-expanded="false">
                    <i class="bx bx-dots-vertical-rounded"></i>
                </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#modalCenter" style="font-family: 'Almarai', sans-serif; font-size:18px;">رفع ملف اكسل</a></li>
                        <li><a class="dropdown-item" href="~/ExcelTempletsFiles/AgentsSellingPoint.xlsx" download style="font-family: 'Almarai', sans-serif; font-size:18px;">تنزيل ملف البيانات</a></li>
                    </ul>
                </div>
            </div>


        <div class="col-md-6 col-lg-4">
            <div class="mt-3">
                <!-- Modal -->
                <div class="modal fade" id="modalCenter" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalCenterTitle" style="font-family: 'Almarai', sans-serif; font-size:18px;">بيانات الوكلاء ونقاط البيع</h5>
                                <button type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col mb-3">
                                        <label for="nameWithTitle" class="form-label" style="font-family: 'Almarai', sans-serif; font-size:18px;">ملف الاكسل</label>
                                        <input class="form-control" type="file" name="FormFile" style="font-family: 'Almarai', sans-serif; font-size:18px;"/>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal" style="font-family: 'Almarai', sans-serif; font-size:18px;">
                                    الغاء
                                </button>
                                <button type="submit" asp-action="ImportExcelFileAP" asp-controller="CreateFacility" class="btn btn-primary" style="font-family: 'Almarai', sans-serif; font-size:18px;">تأكيد</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3">
            
            <div class="col-md-4">
                <label asp-for="ApName" class="form-label fs-5">الاسم</label>
                <input asp-for="ApName" class="form-control" placeholder="الاسم" />
                <span asp-validation-for="ApName" class="text-danger"></span>
                @if (TempData.ContainsKey("ApNameError"))
                {

                    <span class="text-danger">@TempData["ApNameError"]</span>
                }
            </div>

            <div class="col-md-4">
                <label asp-for="ApTradeName" class="form-label fs-5">الاسم التجاري</label>
                <input asp-for="ApTradeName" class="form-control" placeholder="الاسم التجاري" />
                <span asp-validation-for="ApTradeName" class="text-danger"></span>
                @if (TempData.ContainsKey("ApTradeNameError"))
                {

                    <span class="text-danger">@TempData["ApTradeNameError"]</span>
                }
            </div>

            <div class="col-md-4">
                <label asp-for="ApPhoneNumber" class="form-label fs-5">رقم الهاتف</label>
                <input asp-for="ApPhoneNumber" class="form-control" placeholder="رقم الهاتف" />
                <span asp-validation-for="ApPhoneNumber" class="text-danger"></span>
                @if (TempData.ContainsKey("ApPhoneNumberError"))
                {

                    <span class="text-danger">@TempData["ApPhoneNumberError"]</span>
                }
            </div>

            <div class="col-md-6">
                <label asp-for="ApAddress" class="form-label fs-5">العنوان</label>
                <input asp-for="ApAddress" class="form-control" placeholder="العنوان" />
                <span asp-validation-for="ApAddress" class="text-danger"></span>
                @if (TempData.ContainsKey("ApAddressError"))
                {

                    <span class="text-danger">@TempData["ApAddressError"]</span>
                }
            </div>


            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="ApType" class="form-label fs-5">النوع</label>
                    <select asp-for="ApType" class="select2 form-select form-select-lg fs-5">
                        <option value=Null selected hidden disabled>حدد النوع</option>
                        <option value="وكيل">وكيل</option>
                        <option value="نقطة بيع">نقطة بيع</option>
                    </select>
                    <span asp-validation-for="ApType" class="text-danger"></span>
                    @if (TempData.ContainsKey("ApTypeError"))
                    {

                        <span class="text-danger">@TempData["ApTypeError"]</span>
                    }
                </div>
            </div>


            <input asp-for="FaId" value="1" hidden />

            <div class="row-md-6">
                <label asp-for="ApNotes" class="form-label fs-5">ملاحظات</label>
                <textarea asp-for="ApNotes" class="form-control" rows="1" placeholder="أكتب أي ملاحظات أخرى"></textarea>
            </div>

            <div class="pt-4">
                <div class="row justify-content-end">
                    <div class="col-sm-7">
                        <button asp-action="AgentsSellingPointsData" asp-controller="CreateFacility" type="submit" class="btn btn-primary me-1 me-sm-2">أضافة</button>
                    </div>
                </div>
            </div>


            <div class="table-responsive text-nowrap mt-5 " style="width:100%;">
                <table class="table" id="MaTable">
                    <thead>
                        <tr>
                            <td>رقم الوكيل/نقطة البيع</td>
                            <td>الاسم</td>
                            <td>الاسم التجاري</td>
                            <td>رقم الهاتف</td>
                            <td> العنوان </td>
                            <td> النوع </td>
                            <td> ملاحظات </td>
                            <td>إجراءات</td>
                        </tr>
                    </thead>
                    <tbody>
                        @if (GetAllAgentsPoint is not null)
                        {
                            @foreach (var item in GetAllAgentsPoint)
                            {
                                <tr>
                                    <td>@counter</td>
                                    <td>@item.Cel1</td>
                                    <td>@item.Cel2</td>
                                    <td>@item.Cel3</td>
                                    <td>@item.Cel4</td>
                                    <td>@item.Cel5</td>
                                    <td>@item.Cel6</td>
                                    <td>
                                        <a asp-action="DeleteAgentsSellingPoints" asp-controller="CreateFacility" asp-route-Id="@item.Id"
                                   class="btn btn-outline-danger p1-3 pr-3 py-1">
                                            <i class="bx bx-trash ms-1 ms-1"></i>
                                        </a>
                                    </td>
                                </tr>
                                counter = counter + 1;
                            }
                        }
                    </tbody>

                </table>
            </div>

        </div>


        <hr class="mx-n4 my-4" />

        <div style="font-family: 'Almarai', sans-serif; font-size:16px;" class="col justify-content-center">
            <a href="@Url.Action("TransportationData","CreateFacility")" type="button" class="btn btn-label-secondary">السابق</a>
            <button asp-action="AgentsSellingPointsNext" asp-controller="CreateFacility" type="submit" class="btn btn-primary me-1 me-sm-2">التالي</button>
        </div>


    </div>
</form>