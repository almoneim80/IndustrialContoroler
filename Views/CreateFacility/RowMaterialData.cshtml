@using Microsoft.EntityFrameworkCore;
@using IndustrialContoroler.Models.FacilityViewModels;
@using IndustrialContoroler.Models.Repositories;
@model RowMaterial;
@inject IRepository<Temporary> rowmaterial;


    @if (TempData.ContainsKey("Error"))
{
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["Error"]</div>
}

@if (TempData.ContainsKey("success"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-primary ms-3 me-3" role="alert">@TempData["success"]</div>
}

@if (TempData.ContainsKey("ExFileNull"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["ExFileNull"]</div>
}
@if (TempData.ContainsKey("InsertNull"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["InsertNull"]</div>
}

@{
    //get all buildings from Temporary table to show them in table.
    var GetAllRowMaterial = rowmaterial.GetAll().Where(Bu => Bu.TblDesc == "rowmaterial").ToList();
    //for number of buildings in table.
    int counter = 1;
}

<form method="post" class="card mb-4 ms-3 me-3" enctype="multipart/form-data" style="font-family: 'Almarai', sans-serif; font-size:18px;">
    <h3 style="font-family: 'Almarai', sans-serif; font-size:20px;  background-color: rgb(82, 134, 203); color: azure;" class=" card-header py-3 mb-10 "> بيانات المواد الخام </h3>
    <div class="card-body">

        <div class="d-flex justify-content-between mt-1">
            <div class="float-start">
            </div>
            <div class="float-end">
                <button type="button"
                        class="btn btn-primary btn-icon rounded-pill dropdown-toggle hide-arrow"
                        data-bs-toggle="dropdown"
                        aria-expanded="false">
                    <i class="bx bx-dots-vertical-rounded"></i>
                </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#modalCenter" style="font-family: 'Almarai', sans-serif; font-size:18px;">رفع ملف اكسل</a></li>
                        <li><a class="dropdown-item" href="~/ExcelTempletsFiles/RowMaterial.xlsx" download style="font-family: 'Almarai', sans-serif; font-size:18px;">تنزيل ملف البيانات</a></li>
                    </ul>
                </div>
            </div>

        <div class="col-md-6 col-lg-4">
            <div class="mt-3">
                <!-- Modal -->
                <div class="modal fade" id="modalCenter" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalCenterTitle" style="font-family: 'Almarai', sans-serif; font-size:18px;">بيانات المواد الخام</h5>
                                <button type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col mb-3">
                                        <label for="nameWithTitle" class="form-label" style="font-family: 'Almarai', sans-serif; font-size:18px;">ملف الاكسل</label>
                                        <input class="form-control" type="file" name="FormFile" style="font-family: 'Almarai', sans-serif; font-size:18px;"/>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal" style="font-family: 'Almarai', sans-serif; font-size:18px;">
                                    الغاء
                                </button>
                                <button type="submit" asp-action="ImportExcelFileRM" asp-controller="CreateFacility" class="btn btn-primary" style="font-family: 'Almarai', sans-serif; font-size:18px;">تأكيد</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row g-3">
            <div class="col-md-4">
                <label asp-for="RmName" class="form-label fs-5">اسم المادة الخام</label>
                <input asp-for="RmName" class="form-control" placeholder="اسم المادة الخام" />
                <span asp-validation-for="RmName" class="text-danger"></span>
                @if (TempData.ContainsKey("RmNameError"))
                {
                    
                    <span class="text-danger">@TempData["RmNameError"]</span>
                }
            </div>

            <div class="col-md-4">
                <label asp-for="RmMeasruingUnit" class="form-label fs-5">وحدة القياس</label>
                <input asp-for="RmMeasruingUnit" class="form-control" placeholder="وحدة القياس" />
                <span asp-validation-for="RmMeasruingUnit" class="text-danger"></span>
                @if (TempData.ContainsKey("RmMeasruingUnitError"))
                {
                    
                    <span class="text-danger">@TempData["RmMeasruingUnitError"]</span>
                }
            </div>

            <div class="col-md-4">
                <label asp-for="RmPercentInPro" class="form-label fs-5">النسبة المئوية في المنتج</label>
                <input asp-for="RmPercentInPro" class="form-control" placeholder="النسبة المئوية في المنتج" />
                <span asp-validation-for="RmPercentInPro" class="text-danger"></span>
                @if (TempData.ContainsKey("RmPercentInProError"))
                {
                    
                    <span class="text-danger">@TempData["RmPercentInProError"]</span>
                }
            </div>

            <div class="col-md-6">
                <label asp-for="RmAmountUsed" class="form-label fs-5">الكمية المستخدمة سنوياً</label>
                <input asp-for="RmAmountUsed" class="form-control" placeholder="الكمية المستخدمة سنوياً" />
                <span asp-validation-for="RmAmountUsed" class="text-danger"></span>
                @if (TempData.ContainsKey("MaUsesError"))
                {
                    
                    <span class="text-danger">@TempData["MaUsesError"]</span>
                }
            </div>


            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="RmSource" class="form-label fs-5">المصدر</label>
                    <select asp-for="RmSource" class="select2 form-select form-select-lg fs-5">
                        <option value=Null disabled selected hidden>حدد مصدر المادة الخام</option>
                        <option value="مستورد">مستورد</option>
                        <option value="محلي">محلي</option>
                    </select>
                    <span asp-validation-for="RmSource" class="text-danger"></span>
                    @if (TempData.ContainsKey("RmSourceError"))
                {
                    
                    <span class="text-danger">@TempData["RmSourceError"]</span>
                }
                </div>
            </div>

            <input asp-for="FaId" value="1" hidden />

            <div class="row-md-6">
                <label asp-for="RmNotes" class="form-label fs-5">ملاحظات</label>
                <textarea asp-for="RmNotes" class="form-control" rows="1" placeholder="أكتب أي ملاحظات أخرى"></textarea>
            </div>

            <div class="pt-4">
                <div class="row justify-content-end">
                    <div class="col-sm-7">
                        <button asp-action="RowMaterialData" asp-controller="CreateFacility" type="submit" class="btn btn-primary me-1 me-sm-2">أضافة</button>
                    </div>
                </div>
            </div>


            <div class="table-responsive text-nowrap mt-5 " style="width:100%;">
                <table class="table" id="MaTable">
                    <thead>
                        <tr>
                            <td>رقم المادة</td>
                            <td>اسم المادة</td>
                            <td>وحدة القياس</td>
                            <td>الكمية المستخدمة</td>
                            <td>النسبة المستخدمة في المنتج</td>
                            <td>المصدر</td>
                            <td> ملاحظات </td>
                            <td>إجراءات</td>
                        </tr>
                    </thead>
                    <tbody>
                        @if (GetAllRowMaterial is not null)
                        {
                            @foreach (var item in GetAllRowMaterial)
                            {
                                <tr>
                                    <td>@counter</td>
                                    <td>@item.Cel1</td>
                                    <td>@item.Cel2</td>
                                    <td>@item.Cel3</td>
                                    <td>@item.Cel4</td>
                                    <td>@item.Cel5</td>
                                    <td>@item.Cel6</td>
                                    <td>
                                        <a asp-action="DeleteRowMaterial" asp-controller="CreateFacility" asp-route-Id="@item.Id"
                                   class="btn btn-outline-danger p1-3 pr-3 py-1">
                                            <i class="bx bx-trash ms-1 ms-1"></i>
                                        </a>
                                    </td>
                                </tr>
                                counter = counter + 1;
                            }
                        }
                    </tbody>

                </table>
            </div>

        </div>


        <hr class="mx-n4 my-4" />

        <div style="font-family: 'Almarai', sans-serif; font-size:16px;" class="col justify-content-center">
            <a href="@Url.Action("WorkersData","CreateFacility")" type="button" class="btn btn-label-secondary">السابق</a>
            <button asp-action="RowMaterialNext" asp-controller="CreateFacility" type="submit" class="btn btn-primary me-1 me-sm-2">التالي</button>
        </div>


    </div>
</form>