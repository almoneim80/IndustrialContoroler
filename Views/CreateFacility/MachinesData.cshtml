@using Microsoft.EntityFrameworkCore;
@using IndustrialContoroler.Models.FacilityViewModels;
@using IndustrialContoroler.Models.Repositories;
@model Machine;
@inject IRepository<Temporary> machines;
@inject IRepository<Temporary> FaId;


    @if (TempData.ContainsKey("Error"))
{
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["Error"]</div>
}


@if (TempData.ContainsKey("success"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-primary ms-3 me-3" role="alert">@TempData["success"]</div>
}

@if (TempData.ContainsKey("ExFileNull"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["ExFileNull"]</div>
}
@if (TempData.ContainsKey("InsertNull"))
{
    //if no data inserted for buildings show this error massege.
    <div class="alert alert-danger ms-3 me-3" role="alert">@TempData["InsertNull"]</div>
}

@{
    //get all buildings from Temporary table to show them in table.
    var GetAllMachines = machines.GetAll().Where(Bu => Bu.TblDesc == "machine").ToList();
    //for number of buildings in table.
    int counter = 1;
    //get FaNumber
    var FaNo = FaId.GetAll().FirstOrDefault(FaNo => FaNo.TblDesc == "facility");
}

<form method="post" class="card mb-4 ms-3 me-3" enctype="multipart/form-data">
            <h3 style="font-family: 'Almarai', sans-serif; font-size:20px;  background-color: rgb(82, 134, 203); color: azure;" class=" card-header py-3 mb-10 ">بيانات الآلات والمعدات </h3>
    <div class="card-body" style="font-family: 'Almarai', sans-serif; font-size:18px;">
        
        <div class="d-flex justify-content-between mt-1">
            <div class="float-start">
            </div>
            <div class="float-end">
                <button type="button"
                        class="btn btn-primary btn-icon rounded-pill dropdown-toggle hide-arrow"
                        data-bs-toggle="dropdown"
                        aria-expanded="false">
                    <i class="bx bx-dots-vertical-rounded"></i>
                </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#modalCenter" style="font-family: 'Almarai', sans-serif; font-size:18px;">رفع ملف اكسل</a></li>
                        <li><a class="dropdown-item" href="~/ExcelTempletsFiles/Machine.xlsx" download style="font-family: 'Almarai', sans-serif; font-size:18px;">تنزيل ملف البيانات</a></li>
                    </ul>
                </div>
            </div>
        
        <div class="col-md-6 col-lg-4">
            <div class="mt-3">
                <!-- Modal -->
                <div class="modal fade" id="modalCenter" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalCenterTitle" style="font-family: 'Almarai', sans-serif; font-size:18px;">بيانات الآلات والمعدات</h5>
                                <button type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col mb-3">
                                        <label for="nameWithTitle" class="form-label" style="font-family: 'Almarai', sans-serif; font-size:18px;">ملف الاكسل</label>
                                        <input class="form-control" type="file" name="FormFile" style="font-family: 'Almarai', sans-serif; font-size:18px;"/>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal" style="font-family: 'Almarai', sans-serif; font-size:18px;">
                                    الغاء
                                </button>
                                <button type="submit" asp-action="ImportExcelFileMA" asp-controller="CreateFacility" class="btn btn-primary" style="font-family: 'Almarai', sans-serif; font-size:18px;">تأكيد</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row g-3">
            <div class="col-md-4">
                <label asp-for="MaName" class="form-label fs-5">اسم الآلة</label>
                <input asp-for="MaName" class="form-control" placeholder="اسم الآلة" />
                <span asp-validation-for="MaName" class="text-danger"></span>
                @if (TempData.ContainsKey("MaNameError"))
                {

                    <span class="text-danger">@TempData["MaNameError"]</span>
                }
            </div>

            <div class="col-md-4">
                <label asp-for="MaNumber" class="form-label fs-5">العدد</label>
                <input asp-for="MaNumber" class="form-control" placeholder="العدد" />
                <span asp-validation-for="MaNumber" class="text-danger"></span>
                @if (TempData.ContainsKey("MaNumberError"))
                {

                    <span class="text-danger">@TempData["MaNumberError"]</span>
                }
            </div>


            <div class="col-md-4">
                <label asp-for="MaCountryManufacture" class="form-label fs-5">بلد الصنع</label>
                <input asp-for="MaCountryManufacture" class="form-control" placeholder="بلد الصنع" />
                <span asp-validation-for="MaCountryManufacture" class="text-danger"></span>
                @if (TempData.ContainsKey("MaCountryManufactureError"))
                {

                    <span class="text-danger">@TempData["MaCountryManufactureError"]</span>
                }
            </div>

            <div class="col-md-4">
                <label asp-for="MaMeasruingUnit" class="form-label fs-5">وحدة القياس</label>
                <input asp-for="MaMeasruingUnit" class="form-control" placeholder="وحدة القياس" />
                <span asp-validation-for="MaMeasruingUnit" class="text-danger"></span>
                @if (TempData.ContainsKey("MaMeasruingUnitError"))
                {

                    <span class="text-danger">@TempData["MaMeasruingUnitError"]</span>
                }
            </div>


            <div class="col-md-4">
                <label asp-for="MaAbility" class="form-label fs-5">القدرة الفعلية</label>
                <input asp-for="MaAbility" class="form-control" placeholder="القدرة الفعلية" />
                <span asp-validation-for="MaAbility" class="text-danger"></span>
                @if (TempData.ContainsKey("MaAbilityError"))
                {

                    <span class="text-danger">@TempData["MaAbilityError"]</span>
                }
            </div>


            <div class="col-md-4">
                <div class="mb-3">
                    <label asp-for="MaSource" class="form-label fs-5">المصدر</label>
                    <select asp-for="MaSource" class="select2 form-select form-select-lg fs-5">
                        <option value=Null disabled selected hidden>حدد مصدر الآلة</option>
                        <option value="مستورد">مستورد</option>
                        <option value="محلي">محلي</option>
                    </select>
                    <span asp-validation-for="MaSource" class="text-danger"></span>
                    @if (TempData.ContainsKey("MaSourceError"))
                    {

                        <span class="text-danger">@TempData["MaSourceError"]</span>
                    }
                </div>
            </div>

            <div class="col-md-4">
                <label asp-for="MaSourceAddress" class="form-label fs-5">عنوان المصدر</label>
                <input asp-for="MaSourceAddress" class="form-control" placeholder="عنوان المصدر" />
                <span asp-validation-for="MaSourceAddress" class="text-danger"></span>
                @if (TempData.ContainsKey("MaSourceAddressError"))
                {

                    <span class="text-danger">@TempData["MaSourceAddressError"]</span>
                }
            </div>

            <input asp-for="FaId" value="1" hidden />


            <div class="col-md-8">
                <label asp-for="MaUses" class="form-label fs-5">الاستخدامات</label>
                <textarea asp-for="MaUses" class="form-control" placeholder="الاستخدامات" rows="1"></textarea>
                <span asp-validation-for="MaUses" class="text-danger"></span>
                @if (TempData.ContainsKey("MaUsesError"))
                {

                    <span class="text-danger">@TempData["MaUsesError"]</span>
                }
            </div>


            <div class="row-md-6">
                <label asp-for="MaNotes" class="form-label fs-5">ملاحظات</label>
                <textarea asp-for="MaNotes" class="form-control" rows="1" placeholder="أكتب أي ملاحظات أخرى"></textarea>
            </div>

            <div class="pt-4">
                <div class="row justify-content-end">
                    <div class="col-sm-7">
                        <button asp-action="MachinesData" asp-controller="CreateFacility" type="submit" class="btn btn-primary me-1 me-sm-2">أضافة</button>
                    </div>
                </div>
            </div>


            <div class="table-responsive text-nowrap mt-5 " style="width:100%;">
                <table class="table" id="MaTable">
                    <thead>
                        <tr>
                            <td>رقم الآلة</td>
                            <td>اسم الآلة</td>
                            <td>عدد الآلات</td>
                            <td>استخدامات الآلة</td>
                            <td>بلد الصنع</td>
                            <td>وحدة القياس</td>
                            <td>قدرة الآلة</td>
                            <td>مصدر الآلة</td>
                            <td>عنوان المصدر</td>
                            <td> ملاحظات </td>
                            <td>إجراءات</td>
                        </tr>
                    </thead>
                    <tbody>
                        @if (GetAllMachines is not null)
                        {
                            @foreach (var item in GetAllMachines)
                            {
                                <tr>
                                    <td>@counter</td>
                                    <td>@item.Cel1</td>
                                    <td>@item.Cel2</td>
                                    <td>@item.Cel3</td>
                                    <td>@item.Cel4</td>
                                    <td>@item.Cel5</td>
                                    <td>@item.Cel6</td>
                                    <td>@item.Cel7</td>
                                    <td>@item.Cel8</td>
                                    <td>@item.Cel9</td>
                                    <td>
                                        <a asp-action="Deletemachines" asp-controller="CreateFacility" asp-route-Id="@item.Id"
                                   class="btn btn-outline-danger p1-3 pr-3 py-1">
                                            <i class="bx bx-trash ms-1 ms-1"></i>
                                        </a>
                                    </td>
                                </tr>
                                counter = counter + 1;
                            }
                        }
                    </tbody>

                </table>
            </div>

        </div>


        <hr class="mx-n4 my-4" />

        <div style="font-family: 'Almarai', sans-serif; font-size:16px;" class="col justify-content-center">
            <a href="@Url.Action("WorkersData","InsertFacilityData")" type="button" class="btn btn-label-secondary">السابق</a>
            <button asp-action="machinesNext" asp-controller="CreateFacility" type="submit" class="btn btn-primary me-1 me-sm-2">التالي</button>
        </div>


    </div>
</form>