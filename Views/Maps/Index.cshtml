@using IndustrialContoroler.Models;
@using IndustrialContoroler.Models.MapsViewModels;
@model List<MapsVM>
@inject IndustrialContorolerDatabaseContext db;

@{
    var facilities = db.Facilities;


}
@if (TempData.ContainsKey("Requests_reports"))                      @* Error Massage for Request page*@
{
    <div class="alert alert-danger fs-5">@TempData["Requests_reports"]</div>
}


<div class="card mb-4 ms-3 me-3" data-select2-id="29">
    <h5 style="font-family: 'Almarai', sans-serif; font-size:20px;  background-color: rgb(82, 134, 203); color: azure;" class="card-header"><img class="me-3" src="~/img/search25_1.png" alt=""> عرض موقع المنشأة </h5>
    <hr class=" my-1">

    <div class="content-wrapper">

        @if (TempData.ContainsKey("Requests_reports"))                      @* Error Massage for Request page*@
        {
            <div class="alert alert-danger fs-5">@TempData["Requests_reports"]</div>
        }

    </div>

    <form method="post" class="card-body">

        <div class="row">

            <div class="col-3">
                <label style="font-family: 'Cairo', sans-serif; font-size:16px;" class="form-label fs-5" for="multicol-username">اسم المنشأة</label>

                <div style="font-family: 'Almarai', sans-serif; font-size:14px;" class="position-relative">

                    @if (facilities is not null)
                    {
                        List<string> total = new List<string>();


                        <select title="اختر أسم المنشأة" data-live-search="true" name="fa_Name" class="selectpicker w-100 "
                                data-style="btn-default" tabindex="null">
                            @foreach (var item in facilities)
                            {
                                if (!total.Contains(item.FaName))
                                {
                                    total.Add(item.FaName.ToString());

                                    <option value="@item.FaName.ToString()"> @item.FaName.ToString() </option>
                                }
                            }
                        </select>
                    }

                </div>
            </div>

            <div class="col-2">
                <label style="font-family: 'Cairo', sans-serif; font-size:16px;" class="form-label fs-5" for="multicol-username">رقم المنشأة</label>
                <div style="font-family: 'Almarai', sans-serif; font-size:14px;" class="position-relative">

                    @if (facilities is not null)
                    {
                        List<string> total = new List<string>();


                        <select title="اختر رقم المنشأة" data-live-search="true" name="fa_Number" class="selectpicker w-100 "
                                data-style="btn-default" tabindex="null">
                            @foreach (var item in facilities)
                            {
                                if (!total.Contains(item.FaNumber.ToString()))
                                {
                                    total.Add(item.FaNumber.ToString());

                                    <option value="@item.FaNumber.ToString()"> @item.FaNumber.ToString() </option>
                                }
                            }
                        </select>
                    }

                </div>
            </div>
        </div>


        <div class="pt-4">
            <div class="row justify-content-end">
                <div style="font-family: 'Almarai', sans-serif; font-size:16px;" class="col-sm-7">
                    <button type="submit" class="btn btn-primary me-1 me-sm-2"> عرض الخريطة</button>
                    <button type="reset" class="btn btn-label-secondary">تهيئة</button>
                </div>
            </div>
        </div>
        <!--
        <hr class="mx-n4 " />-->
    </form>


</div>



<!--------Maps----------->
<!--------Maps----------->
@if (Model is not null)
{

    <div class="col-xxl ">
        <div class="card mb-4 ms-3 me-3">

            <div id="Staistic_Table">

               @* @foreach (var item in Model)
                {
                   <h1>@item.FaLatitude</h1>
                   <h1>@item.FaLongitude</h1>
                }*@


                <h5 class="fs-4 p-3 fw-bold  w-100 d-flex justify-content-center align-items-center" style="background-color: #e9f2fa; ">
                    موقع @TempData["Maps_fa_Name"]

                </h5>

                <div class=" p-4  d-flex justify-content-center align-items-center ">
                    <div id="map" class="card m-3 mb-3" style="width:100% ; height:500px">  </div>
                </div>





            </div>

        </div>

    </div>

}





<!--JS Leaflet  Googel Map-->
<script src="~/leaflet/leaflet.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.79.0/dist/L.Control.Locate.min.css" />
<script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.79.0/dist/L.Control.Locate.min.js" charset="utf-8"></script>




<script>
    var map = L.map('map').setView([15.35278, 44.20750], 10); //[item.faLatitude, item.faLongitude]

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    L.control
        .locate({
            position: "topright",
            strings: {
                title: "Show me where I am, yo!"
            }
        })
        .addTo(map);

    var model = @Html.Raw(Json.Serialize(Model));
    var map_location;
    console.log(model)



    for (i in model) {
        item = model[i]

    
        L.marker([item.faLatitude, item.faLongitude]).addTo(map)//يحط خطوط الطول والعرض الى الخريطة
            .bindPopup(item.faAddress + '<br/>' + item.faName);// عندالضغط على السهم يظهر العنوان والاسم

    }





</script>




@*

    var model = @Html.Raw(Json.Serialize(fac));
    var map_location ;
 console.log()

    for (i in model) {
        item = model[i]

            L.marker([item.faLatitude, item.faLongitude]).addTo(map)//يحط خطوط الطول والعرض الى الخريطة
                .bindPopup(item.faAddress + '<br/>' + item.faName);// عندالضغط على السهم يظهر العنوان والاسم

   }

  *@